"use strict";(self.webpackChunkls_fusion_docs=self.webpackChunkls_fusion_docs||[]).push([[88633],{66148:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>l});var t=n(74848),o=n(28453);const i={title:"How-to: Data export"},a=void 0,s={id:"How-to_Data_export",title:"How-to: Data export",description:"Example 1",source:"@site/docs/How-to_Data_export.md",sourceDirName:".",slug:"/How-to_Data_export",permalink:"/next/How-to_Data_export",draft:!1,unlisted:!1,editUrl:"https://github.com/lsfusion/platform/edit/master/docs/en/How-to_Data_export.md",tags:[],version:"current",lastUpdatedAt:1623249583,formattedLastUpdatedAt:"Jun 9, 2021",frontMatter:{title:"How-to: Data export"},sidebar:"learn",previous:{title:"How-to: Working with external formats",permalink:"/next/How-to_Working_with_external_formats"},next:{title:"How-to: Data import",permalink:"/next/How-to_Data_import"}},d={},l=[{value:"Example 1",id:"example-1",level:2},{value:"Task",id:"task",level:3},{value:"Solution",id:"solution",level:3},{value:"Example 2",id:"example-2",level:2},{value:"Task",id:"task-1",level:3},{value:"Solution",id:"solution-1",level:3},{value:"Example 3",id:"example-3",level:2},{value:"Task",id:"task-2",level:3},{value:"Solution",id:"solution-2",level:3}];function c(e){const r={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.h2,{id:"example-1",children:"Example 1"}),"\n",(0,t.jsx)(r.h3,{id:"task",children:"Task"}),"\n",(0,t.jsx)(r.p,{children:"We have sales orders for several books."}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-lsf",children:"REQUIRE Time;\r\n\r\nCLASS Book 'Book';\r\nname 'Name' = DATA ISTRING[100] (Book) IN id;\r\n\r\nCLASS Customer 'Customer';\r\nname 'Name' = DATA ISTRING[50] (Customer) IN id;\r\naddress 'Address' = DATA ISTRING[50] (Customer) IN base;\r\n\r\nCLASS Currency 'Currency';\r\nname 'Name' = DATA ISTRING[50] (Currency) IN id;\r\n\r\nCLASS Order 'Order';\r\ndate 'Date' = DATA DATE (Order);\r\nnumber 'Number' = DATA STRING[10] (Order);\r\n\r\ncustomer 'Customer' = DATA Customer (Order);\r\nnameCustomer 'Customer' (Order o) = name(customer(o));\r\n\r\nCLASS OrderDetail 'Order line';\r\norder 'Order' = DATA Order (OrderDetail) NONULL DELETE;\r\n\r\nbook 'Book' = DATA Book (OrderDetail) NONULL;\r\nnameBook 'Book' (OrderDetail d) = name(book(d));\r\n\r\nquantity 'Quantity' = DATA INTEGER (OrderDetail);\r\nprice 'Price' = DATA NUMERIC[14,2] (OrderDetail);\r\n\r\ncurrency 'Currency' = DATA Currency (OrderDetail);\r\nnameCurrency 'Currency' (OrderDetail d) = name(currency(d));\r\n\r\nFORM order 'Order'\r\n    OBJECTS o = Order PANEL\r\n    PROPERTIES(o) date, number, nameCustomer\r\n\r\n    OBJECTS d = OrderDetail\r\n    PROPERTIES(d) nameBook, quantity, nameCurrency, price, NEW, DELETE\r\n    FILTERS order(d) == o\r\n\r\n    EDIT Order OBJECT o\r\n;\r\n\r\nFORM orders 'Orders'\r\n    OBJECTS o = Order\r\n    PROPERTIES(o) READONLY date, number, nameCustomer\r\n    PROPERTIES(o) NEWSESSION NEW, EDIT, DELETE\r\n;\r\n\r\nNAVIGATOR {\r\n    NEW orders;\r\n}\n"})}),"\n",(0,t.jsx)(r.p,{children:"We need to create a button that exports the contents of the order in the XML format."}),"\n",(0,t.jsx)(r.h3,{id:"solution",children:"Solution"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-lsf",children:"GROUP Info;\r\nGROUP Customer : Info;\r\n\r\nGROUP Specification;\r\n\r\nGROUP price;\r\n\r\nFORM Order\r\n    PROPERTIES timeStamp = currentDateTime() ATTR\r\n\r\n    OBJECTS order = Order\r\n    PROPERTIES(order) IN Info date, number\r\n    PROPERTIES IN Customer nameCustomer(order) EXTID 'name', =address(customer(order)) EXTID 'address'\r\n\r\n    PROPERTIES IN Specification count = [GROUP SUM 1 BY order(OrderDetail d)](order) ATTR\r\n\r\n    OBJECTS Detail = OrderDetail IN Specification\r\n    PROPERTIES(Detail) nameBook, quantity,\r\n                       nameCurrency IN price EXTID 'currency' ATTR, price IN price EXTID 'value'\r\n    FILTERS order(Detail) = order\r\n;\r\n\r\nexportToXML 'Export to XML' (Order o) {\r\n    EXPORT Order OBJECTS order = o XML;\r\n    open(exportFile());\r\n}\r\n\r\nEXTEND FORM orders\r\n    PROPERTIES(o) exportToXML TOOLBAR\r\n;\n"})}),"\n",(0,t.jsxs)(r.p,{children:["To upload the data in the XML format, we need to create a form ",(0,t.jsx)(r.a,{href:"/next/Structured_view",children:"with the corresponding structure"})," and then call the ",(0,t.jsxs)(r.a,{href:"/next/EXPORT_operator",children:[(0,t.jsx)(r.code,{children:"EXPORT"})," operator"]}),". This operator will generate a file based on the form and then write the file to the ",(0,t.jsx)(r.code,{children:"exportFile"})," property, which is then opened on the client side using the ",(0,t.jsx)(r.code,{children:"open"}),' action. The file will be opened in the software associated with its extension (i. e. ".xml").']}),"\n",(0,t.jsx)(r.p,{children:"The resulting XML will look like this:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-xml",children:'<Order timeStamp="13.11.18 12:28:58">\r\n   <Info>\r\n      <date>13.11.18</date>\r\n      <number>12</number>\r\n      <Customer>\r\n         <name>Customer2</name>\r\n         <address>Address2</address>\r\n      </Customer>\r\n   </Info>\r\n   <Specification count="2">\r\n      <Detail>\r\n         <nameBook>Book2</nameBook>\r\n         <quantity>1</quantity>\r\n         <price currency="USD">3.99</price>\r\n      </Detail>\r\n      <Detail>\r\n         <nameBook>Book1</nameBook>\r\n         <quantity>2</quantity>\r\n         <price currency="EUR">4.99</price>\r\n      </Detail>\r\n   </Specification>\r\n</Order>\n'})}),"\n",(0,t.jsxs)(r.p,{children:["The parent tag ",(0,t.jsx)(r.code,{children:"Order"})," matches the name of the form. Names of all other tags are defined either by a property name on the form (e. g. ",(0,t.jsx)(r.code,{children:"date"}),", ",(0,t.jsx)(r.code,{children:"number"})," or ",(0,t.jsx)(r.code,{children:"count"}),") or by the special parameter ",(0,t.jsx)(r.code,{children:"EXTID"})," (e. g. ",(0,t.jsx)(r.code,{children:"name"})," and ",(0,t.jsx)(r.code,{children:"address"}),"). Use of ",(0,t.jsx)(r.code,{children:"EXTID"})," is preferable when the form contains several properties with the same name, but for different objects."]}),"\n",(0,t.jsxs)(r.p,{children:['To create "intermediate" tags (e. g. ',(0,t.jsx)(r.code,{children:"Info"}),", ",(0,t.jsx)(r.code,{children:"Customer"})," or ",(0,t.jsx)(r.code,{children:"Specification"}),"), the correspondingly nested groups are created to which the necessary properties are then exported."]}),"\n",(0,t.jsxs)(r.p,{children:["Use of the ",(0,t.jsx)(r.code,{children:"ATTR"})," attribute allows you to put the value not in a separate tag, but in the attribute of a parent tag (e. g. ",(0,t.jsx)(r.code,{children:"timeStamp"})," or ",(0,t.jsx)(r.code,{children:"count"}),")."]}),"\n",(0,t.jsxs)(r.p,{children:["To put the currency attribute into the ",(0,t.jsx)(r.code,{children:"price"})," tag, a group with the corresponding name is created, into which the ",(0,t.jsx)(r.code,{children:"nameCurrency"})," and ",(0,t.jsx)(r.code,{children:"price"})," properties are then added. Since the ",(0,t.jsx)(r.code,{children:"ATTR"})," attribute is specified for currency, the currency is added to the ",(0,t.jsx)(r.code,{children:"price"})," tag as attribute. And for the price, the predefined ",(0,t.jsx)(r.code,{children:"EXTID 'value'"})," is set and therefore the value is written directly to the ",(0,t.jsx)(r.code,{children:"price"})," tag. Without all these parameters, the result would be as follows:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-xml",children:"<price><currency>USD</currency><price>4.99</price></price>\n"})}),"\n",(0,t.jsx)(r.p,{children:"If you have a target XML template into which you need to export data, then use the following rules."}),"\n",(0,t.jsx)(r.p,{children:"Any tag in the resulting file is generated by one of four elements:"}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.em,{children:"Property"})," (to be declared using ",(0,t.jsx)(r.code,{children:"PROPERTIES"}),")."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.em,{children:"Object"})," (to be declared using ",(0,t.jsx)(r.code,{children:"OBJECTS"}),")."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.em,{children:"Property group"})," (to be declared using ",(0,t.jsx)(r.code,{children:"GROUP"})," outside the form)."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.em,{children:"Form"})," (the upper tag)"]}),"\n"]}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:["If the tag repeats several times in a row (e. g. ",(0,t.jsx)(r.code,{children:"Detail"}),"), declare an ",(0,t.jsx)(r.em,{children:"object"})," with the matching name."]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:["If a tag contains nested tags, but is used only once (e. g. ",(0,t.jsx)(r.code,{children:"Specification"}),"), then declare a ",(0,t.jsx)(r.em,{children:"property group"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:["If the tag contains attributes (e. g. ",(0,t.jsx)(r.code,{children:'count = "2"'}),"), then it must be generated either by a ",(0,t.jsx)(r.em,{children:"property group"})," or by an ",(0,t.jsx)(r.em,{children:"object"})," (depending on whether this tag is used once or more)."]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:["If the tag contains a value, then such tag must be generated either by a ",(0,t.jsx)(r.em,{children:"property"})," (e. g. ",(0,t.jsx)(r.code,{children:"nameBook"})," or ",(0,t.jsx)(r.code,{children:"quantity"}),') with the corresponding name or by an object/property group with the only "nested" property having ',(0,t.jsx)(r.code,{children:"EXTID 'value'"}),")."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"example-2",children:"Example 2"}),"\n",(0,t.jsx)(r.h3,{id:"task-1",children:"Task"}),"\n",(0,t.jsxs)(r.p,{children:["Similar to ",(0,t.jsx)(r.a,{href:"#example-1",children:(0,t.jsx)(r.strong,{children:"Example 1"})}),"."]}),"\n",(0,t.jsx)(r.p,{children:"We need to create a button that exports the contents of the order in the JSON format."}),"\n",(0,t.jsx)(r.h3,{id:"solution-1",children:"Solution"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-lsf",children:"exportToJSON 'Export to JSON' (Order o) {\r\n    EXPORT Order OBJECTS order = o JSON;\r\n    open(exportFile());\r\n}\r\n\r\nEXTEND FORM orders\r\n    PROPERTIES(o) exportToJSON TOOLBAR\r\n;\n"})}),"\n",(0,t.jsx)(r.p,{children:"The resulting file will look like this:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-json",children:'{  \r\n   "timeStamp":"13.11.18 15:11:45",\r\n   "Info":{  \r\n      "date":"13.11.18",\r\n      "number":"12",\r\n      "Customer":{  \r\n         "address":"Address 2",\r\n         "name":"Customer 2"\r\n      }\r\n   },\r\n   "Specification":{  \r\n      "count":2,\r\n      "Detail":[  \r\n         {  \r\n            "quantity":1,\r\n            "price":3.99,\r\n            "nameBook":"Book 2"\r\n         },\r\n         {  \r\n            "quantity":2,\r\n            "price":4.99,\r\n            "nameBook":"Book 1"\r\n         }\r\n      ]\r\n   }\r\n}\n'})}),"\n",(0,t.jsxs)(r.p,{children:["Note that the ",(0,t.jsx)(r.code,{children:"ATTR"})," option is ignored when you export data in the JSON format."]}),"\n",(0,t.jsx)(r.h2,{id:"example-3",children:"Example 3"}),"\n",(0,t.jsx)(r.h3,{id:"task-2",children:"Task"}),"\n",(0,t.jsxs)(r.p,{children:["Similar to ",(0,t.jsx)(r.a,{href:"#example-1",children:(0,t.jsx)(r.strong,{children:"Example 1"})}),"."]}),"\n",(0,t.jsx)(r.p,{children:"We need to create a button that exports all the orders for a certain date in the CSV format."}),"\n",(0,t.jsx)(r.h3,{id:"solution-2",children:"Solution"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-lsf",children:"exportToCSV (DATE date) {\r\n    LOCAL file = FILE();\r\n    EXPORT CSV HEADER FROM number = number(order(OrderDetail d)),\r\n                    customer = nameCustomer(order(d)),\r\n                    book = nameBook(d),\r\n                    quantity(d),\r\n                    price(d)\r\n           WHERE date(order(d)) = date TO file;\r\n    WRITE CLIENT DIALOG file() TO 'orders';\r\n}\r\n\r\nFORM exportParameters 'Parameters'\r\n    OBJECTS d = DATE PANEL\r\n    PROPERTIES(d) 'Date' = VALUE\r\n;\r\nexportToCSV 'Export to CSV' () {\r\n    DIALOG exportParameters OBJECTS d INPUT DO\r\n        exportToCSV(d);\r\n}\r\n\r\nEXTEND FORM orders\r\n    PROPERTIES() exportToCSV DRAW o TOOLBAR\r\n;\n"})}),"\n",(0,t.jsxs)(r.p,{children:["The first action gets a date as input and then generates a flat CSV file with a semicolon delimiter using the ",(0,t.jsx)(r.code,{children:"EXPORT"})," operator. The file will look like this:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-csv",children:"number;customer;book;quantity;price\r\n14;Customer 1;Book 1;2;8.99\r\n12;Customer 2;Book 2;1;3.99\r\n12;Customer 2;Book 1;2;4.99\n"})}),"\n",(0,t.jsxs)(r.p,{children:["The column name is overridden for the first three parameters, while the other two use the names of the corresponding properties. The result is first written to the local property ",(0,t.jsx)(r.code,{children:"file"}),". Then the user is prompted to save the file from that property to his workstation. This is done using ",(0,t.jsxs)(r.a,{href:"/next/WRITE_operator",children:[(0,t.jsx)(r.code,{children:"WRITE"})," operator"]}),"."]}),"\n",(0,t.jsx)(r.p,{children:"The second action opens the form, asks the user to enter a date and then calls the first data export action."})]})}function h(e={}){const{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},28453:(e,r,n)=>{n.d(r,{R:()=>a,x:()=>s});var t=n(96540);const o={},i=t.createContext(o);function a(e){const r=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function s(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),t.createElement(i.Provider,{value:r},e.children)}}}]);